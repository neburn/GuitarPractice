<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Practice Manager</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4A90E2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Practice Manager">
    
    <style>
        :root {
            --background: #2D2D2D;
            --sidebar: #1E1E1E;
            --sidebar-active: #4A90E2;
            --card-background: #3A3A3A;
            --card-border: #4A4A4A;
            --button-primary: #4A90E2;
            --button-primary-hover: #357ABD;
            --button-success: #28A745;
            --button-danger: #DC3545;
            --text-primary: #FFFFFF;
            --text-secondary: #CCCCCC;
            --text-muted: #999999;
            --input-background: #4A4A4A;
            --input-border: #5A5A5A;
            --corner-radius: 12px;
            --header-height: 80px;
            --card-padding: 20px;
            --element-spacing: 15px;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            height: var(--header-height);
            background: var(--sidebar);
            border-bottom: 1px solid var(--card-border);
            padding: 0 20px;
        }

        .header-content {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-icon {
            font-size: 32px;
        }

        .title-text h1 {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: var(--text-primary);
        }

        .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Navigation */
        .tab-navigation {
            background: var(--sidebar);
            border-bottom: 1px solid var(--card-border);
            padding: 8px 20px;
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .tab-button {
            background: var(--card-background);
            border: none;
            color: var(--text-secondary);
            padding: 12px 20px;
            border-radius: var(--corner-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            min-width: 120px;
            justify-content: center;
        }

        .tab-button:hover {
            background: var(--card-border);
            color: var(--text-primary);
        }

        .tab-button.active {
            background: var(--sidebar-active);
            color: var(--text-primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            margin-bottom: var(--element-spacing);
            overflow: hidden;
        }

        .card-header {
            padding: var(--card-padding);
            border-bottom: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-header h3 {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-primary);
            margin: 0;
        }

        /* Timer Display */
        .timer-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--element-spacing);
        }

        .timer-display-container {
            text-align: center;
            padding: 40px var(--card-padding);
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            font-family: monospace;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .timer-display.running {
            color: var(--button-success);
        }

        .timer-display.paused {
            color: #FFC107;
        }

        .timer-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: var(--card-padding);
            padding-top: 0;
        }

        /* Forms */
        .input-group {
            margin-bottom: var(--element-spacing);
            padding: 0 var(--card-padding);
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: var(--corner-radius);
            background: var(--input-background);
            color: var(--text-primary);
            font-size: 12px;
            font-family: var(--font-family);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--button-primary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: var(--corner-radius);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--button-primary);
            color: var(--text-primary);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--button-primary-hover);
        }

        .btn-success {
            background: var(--button-success);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--button-danger);
            color: var(--text-primary);
        }

        .btn-warning {
            background: #FFC107;
            color: #000;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 11px;
            min-width: auto;
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--element-spacing);
            margin-bottom: var(--element-spacing);
        }

        .stat-card {
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--sidebar-active);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Goal Display */
        .goal-display {
            max-width: 300px;
            margin: 0 auto;
        }

        .goal-current {
            font-size: 36px;
            font-weight: bold;
            color: var(--sidebar-active);
            margin-bottom: 5px;
        }

        .goal-target {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .goal-bar {
            height: 12px;
            background: var(--card-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .goal-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--button-success), var(--sidebar-active));
            transition: width 0.3s ease;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .btn-close:hover {
            background: var(--card-border);
        }

        .modal-body {
            padding: 20px;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            padding: 15px 20px;
            color: var(--text-primary);
            z-index: 10001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--button-success);
        }

        .toast-error {
            border-left: 4px solid var(--button-danger);
        }

        .toast-warning {
            border-left: 4px solid #FFC107;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .main-content {
                padding: 10px;
            }
            
            .timer-layout {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .tab-navigation {
                overflow-x: auto;
                justify-content: flex-start;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .tab-navigation::-webkit-scrollbar {
                display: none;
            }
            
            .tab-button {
                min-width: 90px;
                flex-shrink: 0;
                padding: 10px 12px;
                font-size: 11px;
            }
            
            .timer-display {
                font-size: 36px;
            }
            
            .timer-display-container {
                padding: 20px 10px;
            }
            
            .timer-controls {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .timer-controls .btn {
                height: 50px;
                font-size: 16px;
            }
            
            .btn {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            .form-input,
            .form-select,
            .form-textarea {
                min-height: 44px;
                font-size: 16px;
            }
            
            .toast {
                top: 10px;
                right: 10px;
                left: 10px;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title">
                    <span class="app-icon">üé∏</span>
                    <div class="title-text">
                        <h1>Practice Manager</h1>
                        <p class="subtitle">Track your practice sessions</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" id="settingsBtn">
                        <span>‚öôÔ∏è</span>
                        <span>Settings</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="tab-navigation">
            <button class="tab-button active" data-tab="practice">
                <span>‚è±Ô∏è</span>
                <span>Practice</span>
            </button>
            <button class="tab-button" data-tab="statistics">
                <span>üìä</span>
                <span>Statistics</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Practice Tab -->
            <section id="practice-tab" class="tab-content active">
                <div class="timer-layout">
                    <!-- Timer Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>‚è±Ô∏è Practice Timer</h3>
                            <span id="timerStatus">Ready</span>
                        </div>
                        
                        <div class="timer-display-container">
                            <div class="timer-display" id="timerDisplay">00:00:00</div>
                        </div>

                        <div class="input-group">
                            <label for="practiceItem">What are you practicing?</label>
                            <select id="practiceItem" class="form-select">
                                <option value="">Select an item...</option>
                                <option value="Scales">Scales</option>
                                <option value="Chords">Chords</option>
                                <option value="Songs">Songs</option>
                                <option value="Technique">Technique</option>
                                <option value="Theory">Theory</option>
                            </select>
                        </div>

                        <div class="timer-controls">
                            <button class="btn btn-success" id="startBtn">
                                <span>‚ñ∂Ô∏è</span>
                                <span>Start</span>
                            </button>
                            <button class="btn btn-warning" id="pauseBtn" disabled>
                                <span>‚è∏Ô∏è</span>
                                <span>Pause</span>
                            </button>
                            <button class="btn btn-danger" id="stopBtn" disabled>
                                <span>‚èπÔ∏è</span>
                                <span>Stop</span>
                            </button>
                        </div>
                    </div>

                    <!-- Session Notes -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìù Session Notes</h3>
                            <span id="notesStatus"></span>
                        </div>
                        <div class="input-group">
                            <textarea id="sessionNotes" class="form-textarea" rows="6" 
                                placeholder="What did you work on? Any breakthroughs or challenges?"></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Statistics Tab -->
            <section id="statistics-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTime">0h 0m</div>
                        <div class="stat-label">Total Practice Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalSessions">0</div>
                        <div class="stat-label">Practice Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="averageSession">0m</div>
                        <div class="stat-label">Average Session</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dailyGoalProgress">0%</div>
                        <div class="stat-label">Daily Goal Progress</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>üéØ Daily Goal</h3>
                        <button class="btn btn-primary btn-small" id="editDailyGoal">Edit Goal</button>
                    </div>
                    <div style="padding: 20px; text-align: center;">
                        <div class="goal-display">
                            <div class="goal-current" id="goalCurrent">0 min</div>
                            <div class="goal-target">of <span id="goalTarget">60</span> min goal</div>
                            <div class="goal-bar">
                                <div class="goal-progress" id="goalProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Settings</h3>
                <button class="btn-close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="dailyGoalInput">Daily Practice Goal (minutes)</label>
                    <input type="number" id="dailyGoalInput" class="form-input" min="5" max="480" value="60">
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-danger" id="cancelSettings">Cancel</button>
                    <button class="btn btn-success" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Goal Edit Modal -->
    <div id="dailyGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üéØ Edit Daily Goal</h3>
                <button class="btn-close" id="closeDailyGoal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="newDailyGoal">Daily Practice Goal (minutes)</label>
                    <input type="number" id="newDailyGoal" class="form-input" min="5" max="480" value="60">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-danger" id="cancelDailyGoal">Cancel</button>
                    <button class="btn btn-success" id="saveDailyGoal">Save Goal</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State - Session notes worden hier opgeslagen
        const appState = {
            activeTab: 'practice',
            timer: {
                isRunning: false,
                isPaused: false,
                startTime: null,
                elapsed: 0,
                currentItem: null
            },
            settings: {
                dailyGoal: 60
            },
            data: {
                sessions: [],
                notes: {} // Hier worden de session notes opgeslagen per item
            }
        };

        let timerInterval = null;

        // Initialize App
        function initApp() {
            console.log('üöÄ Initializing Practice Manager...');
            loadData();
            setupEventListeners();
            updateUI();
            console.log('‚úÖ App initialized successfully');
        }

        // Event Listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tabId = e.currentTarget.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Timer controls
            document.getElementById('startBtn').addEventListener('click', startTimer);
            document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
            document.getElementById('stopBtn').addEventListener('click', stopTimer);

            // Session notes - Save automatically when typing
            document.getElementById('sessionNotes').addEventListener('input', saveSessionNotes);

            // Practice item selection - Load notes when item changes
            document.getElementById('practiceItem').addEventListener('change', loadSessionNotes);

            // Settings
            document.getElementById('settingsBtn').addEventListener('click', showSettingsModal);
            document.getElementById('closeSettings').addEventListener('click', hideSettingsModal);
            document.getElementById('cancelSettings').addEventListener('click', hideSettingsModal);
            document.getElementById('saveSettings').addEventListener('click', saveSettings);

            // Daily goal
            document.getElementById('editDailyGoal').addEventListener('click', showDailyGoalModal);
            document.getElementById('closeDailyGoal').addEventListener('click', hideDailyGoalModal);
            document.getElementById('cancelDailyGoal').addEventListener('click', hideDailyGoalModal);
            document.getElementById('saveDailyGoal').addEventListener('click', saveDailyGoal);

            // Modal close on outside click
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    hideSettingsModal();
                    hideDailyGoalModal();
                }
            });

            console.log('‚úÖ Event listeners setup complete');
        }

        // Tab Management
        function switchTab(tabId) {
            // Update navigation
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');

            appState.activeTab = tabId;

            // Load tab-specific data
            if (tabId === 'statistics') {
                updateStatistics();
            }
        }

        // Timer Functions
        function startTimer() {
            const selectedItem = document.getElementById('practiceItem').value;
            if (!selectedItem) {
                showToast('Please select what you are practicing!', 'warning');
                return;
            }

            if (appState.timer.isPaused) {
                // Resume
                appState.timer.startTime = Date.now() - appState.timer.elapsed;
                appState.timer.isPaused = false;
            } else {
                // Fresh start
                appState.timer.startTime = Date.now();
                appState.timer.elapsed = 0;
                appState.timer.currentItem = selectedItem;
                
                // Load notes for this item
                loadSessionNotes();
            }

            appState.timer.isRunning = true;
            updateTimerButtons();
            
            timerInterval = setInterval(updateTimer, 1000);
            showToast('Timer started!', 'success');
        }

        function pauseTimer() {
            appState.timer.isRunning = false;
            appState.timer.isPaused = true;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            updateTimerButtons();
            showToast('Timer paused', 'warning');
        }

        function stopTimer() {
            const sessionDuration = Math.floor(appState.timer.elapsed / 1000);
            
            appState.timer.isRunning = false;
            appState.timer.isPaused = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Save session if longer than 1 minute
            if (sessionDuration >= 60) {
                saveSession(appState.timer.currentItem, sessionDuration);
                showToast('Session saved!', 'success');
            }
            
            // Reset timer
            appState.timer.elapsed = 0;
            appState.timer.startTime = null;
            appState.timer.currentItem = null;
            
            updateTimerDisplay();
            updateTimerButtons();
            updateStatistics();
        }

        function updateTimer() {
            if (appState.timer.isRunning && appState.timer.startTime) {
                appState.timer.elapsed = Date.now() - appState.timer.startTime;
                updateTimerDisplay();
            }
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timerDisplay');
            const seconds = Math.floor(appState.timer.elapsed / 1000);
            display.textContent = formatTime(seconds);
            
            if (appState.timer.isRunning) {
                display.classList.add('running');
                display.classList.remove('paused');
                document.title = `${formatTime(seconds)} - Practice Manager`;
            } else if (appState.timer.isPaused) {
                display.classList.add('paused');
                display.classList.remove('running');
            } else {
                display.classList.remove('running', 'paused');
                document.title = 'Practice Manager';
            }
        }

        function updateTimerButtons() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (appState.timer.isRunning) {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                startBtn.innerHTML = '<span>‚ñ∂Ô∏è</span><span>Running...</span>';
            } else if (appState.timer.isPaused) {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = false;
                startBtn.innerHTML = '<span>‚ñ∂Ô∏è</span><span>Resume</span>';
            } else {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                startBtn.innerHTML = '<span>‚ñ∂Ô∏è</span><span>Start</span>';
            }
        }

        // Session Notes Functions - HIER IS DE OPSLAG!
        function saveSessionNotes() {
            const notes = document.getElementById('sessionNotes').value;
            const currentItem = appState.timer.currentItem || document.getElementById('practiceItem').value || 'general';
            
            // Opslaan in appState.data.notes object
            appState.data.notes[currentItem] = notes;
            
            // Direct opslaan naar localStorage
            saveData();
            
            // Visual feedback
            const status = document.getElementById('notesStatus');
            status.textContent = '‚úì Saved';
            status.style.color = 'var(--button-success)';
            setTimeout(() => {
                status.textContent = '';
            }, 2000);
            
            console.log('üìù Session notes saved for:', currentItem, notes);
        }

        function loadSessionNotes() {
            const currentItem = appState.timer.currentItem || document.getElementById('practiceItem').value || 'general';
            const notes = appState.data.notes[currentItem] || '';
            document.getElementById('sessionNotes').value = notes;
            console.log('üìñ Session notes loaded for:', currentItem, notes);
        }

        // Statistics Functions
        function updateStatistics() {
            const sessions = appState.data.sessions;
            
            if (sessions.length === 0) {
                document.getElementById('totalTime').textContent = '0h 0m';
                document.getElementById('totalSessions').textContent = '0';
                document.getElementById('averageSession').textContent = '0m';
                document.getElementById('dailyGoalProgress').textContent = '0%';
                updateDailyGoalDisplay(0);
                return;
            }
            
            const totalTime = sessions.reduce((sum, session) => sum + session.duration, 0);
            const totalSessions = sessions.length;
            const averageSession = Math.floor(totalTime / totalSessions);
            
            // Calculate today's progress
            const today = new Date().toDateString();
            const todaySessions = sessions.filter(session => 
                new Date(session.date).toDateString() === today
            );
            const todayTime = todaySessions.reduce((sum, session) => sum + session.duration, 0);
            const todayMinutes = Math.floor(todayTime / 60);
            const goalProgress = Math.min((todayMinutes / appState.settings.dailyGoal) * 100, 100);
            
            document.getElementById('totalTime').textContent = formatTime(totalTime);
            document.getElementById('totalSessions').textContent = totalSessions;
            document.getElementById('averageSession').textContent = formatTime(averageSession);
            document.getElementById('dailyGoalProgress').textContent = Math.round(goalProgress) + '%';
            
            updateDailyGoalDisplay(todayMinutes);
        }

        function updateDailyGoalDisplay(currentMinutes) {
            document.getElementById('goalCurrent').textContent = `${currentMinutes} min`;
            document.getElementById('goalTarget').textContent = appState.settings.dailyGoal;
            
            const progress = Math.min((currentMinutes / appState.settings.dailyGoal) * 100, 100);
            document.getElementById('goalProgressBar').style.width = progress + '%';
        }

        // Settings Functions
        function showSettingsModal() {
            document.getElementById('settingsModal').style.display = 'block';
            document.getElementById('dailyGoalInput').value = appState.settings.dailyGoal;
        }

        function hideSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function saveSettings() {
            appState.settings.dailyGoal = parseInt(document.getElementById('dailyGoalInput').value);
            
            saveData();
            updateStatistics();
            hideSettingsModal();
            showToast('Settings saved!', 'success');
        }

        // Daily Goal Functions
        function showDailyGoalModal() {
            document.getElementById('dailyGoalModal').style.display = 'block';
            document.getElementById('newDailyGoal').value = appState.settings.dailyGoal;
        }

        function hideDailyGoalModal() {
            document.getElementById('dailyGoalModal').style.display = 'none';
        }

        function saveDailyGoal() {
            const newGoal = parseInt(document.getElementById('newDailyGoal').value);
            if (newGoal >= 5 && newGoal <= 480) {
                appState.settings.dailyGoal = newGoal;
                saveData();
                updateStatistics();
                hideDailyGoalModal();
                showToast('Daily goal updated!', 'success');
            } else {
                showToast('Goal must be between 5 and 480 minutes', 'error');
            }
        }

        // Data Management - HIER WORDT ALLES OPGESLAGEN
        function saveSession(item, duration) {
            const session = {
                id: Date.now(),
                item,
                duration,
                date: new Date().toISOString(),
                notes: appState.data.notes[item] || ''
            };
            
            appState.data.sessions.push(session);
            saveData();
            console.log('üíæ Session saved:', session);
        }

        function saveData() {
            // Alle data inclusief session notes opslaan naar localStorage
            const dataToSave = {
                sessions: appState.data.sessions,
                notes: appState.data.notes,  // Session notes per item
                settings: appState.settings
            };
            localStorage.setItem('practiceManagerData', JSON.stringify(dataToSave));
            console.log('üíæ Data saved to localStorage:', dataToSave);
        }

        function loadData() {
            const saved = localStorage.getItem('practiceManagerData');
            if (saved) {
                try {
                    const loadedData = JSON.parse(saved);
                    appState.data.sessions = loadedData.sessions || [];
                    appState.data.notes = loadedData.notes || {};  // Session notes laden
                    appState.settings.dailyGoal = loadedData.settings?.dailyGoal || 60;
                    console.log('üìÇ Data loaded from localStorage:', loadedData);
                } catch (e) {
                    console.error('‚ùå Error loading data:', e);
                }
            }
        }

        function updateUI() {
            updateStatistics();
            updateTimerDisplay();
            updateTimerButtons();
            loadSessionNotes(); // Load notes for current/selected item
        }

        // Utility Functions
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            
            // Mobile optimizations
            setupMobileOptimizations();
        });

        // Mobile-specific optimizations
        function setupMobileOptimizations() {
            // Prevent zoom on double tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Handle orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    updateUI();
                }, 500);
            });
        }

        // Debug function om de data te bekijken
        function debugShowData() {
            console.log('üîç Current app state:', appState);
            console.log('üîç localStorage data:', localStorage.getItem('practiceManagerData'));
            console.log('üîç Session notes:', appState.data.notes);
        }

        // Maak debug functie beschikbaar in console
        window.debugShowData = debugShowData;
