<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Practice Manager</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4A90E2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Practice Manager">
    
    <style>
        :root {
            --background: #2D2D2D;
            --sidebar: #1E1E1E;
            --sidebar-active: #4A90E2;
            --card-background: #3A3A3A;
            --card-border: #4A4A4A;
            --button-primary: #4A90E2;
            --button-primary-hover: #357ABD;
            --button-success: #28A745;
            --button-danger: #DC3545;
            --text-primary: #FFFFFF;
            --text-secondary: #CCCCCC;
            --text-muted: #999999;
            --input-background: #4A4A4A;
            --input-border: #5A5A5A;
            --corner-radius: 12px;
            --header-height: 80px;
            --card-padding: 20px;
            --element-spacing: 15px;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            height: var(--header-height);
            background: var(--sidebar);
            border-bottom: 1px solid var(--card-border);
            padding: 0 20px;
        }

        .header-content {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-icon {
            font-size: 32px;
        }

        .title-text h1 {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: var(--text-primary);
        }

        .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Navigation */
        .tab-navigation {
            background: var(--sidebar);
            border-bottom: 1px solid var(--card-border);
            padding: 8px 20px;
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .tab-button {
            background: var(--card-background);
            border: none;
            color: var(--text-secondary);
            padding: 12px 20px;
            border-radius: var(--corner-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            min-width: 120px;
            justify-content: center;
        }

        .tab-button:hover {
            background: var(--card-border);
            color: var(--text-primary);
        }

        .tab-button.active {
            background: var(--sidebar-active);
            color: var(--text-primary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            margin-bottom: var(--element-spacing);
            overflow: hidden;
        }

        .card-header {
            padding: var(--card-padding);
            border-bottom: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-header h3 {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-primary);
            margin: 0;
        }

        /* Timer Display */
        .timer-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--element-spacing);
        }

        .timer-display-container {
            text-align: center;
            padding: 40px var(--card-padding);
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            font-family: monospace;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .timer-display.running {
            color: var(--button-success);
        }

        .timer-display.paused {
            color: #FFC107;
        }

        .timer-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: var(--card-padding);
            padding-top: 0;
        }

        /* Forms */
        .input-group {
            margin-bottom: var(--element-spacing);
            padding: 0 var(--card-padding);
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: var(--corner-radius);
            background: var(--input-background);
            color: var(--text-primary);
            font-size: 12px;
            font-family: var(--font-family);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--button-primary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: var(--corner-radius);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--button-primary);
            color: var(--text-primary);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--button-primary-hover);
        }

        .btn-success {
            background: var(--button-success);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--button-danger);
            color: var(--text-primary);
        }

        .btn-warning {
            background: #FFC107;
            color: #000;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 11px;
            min-width: auto;
        }

        /* Library Layout */
        .library-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--element-spacing);
        }

        .library-nav {
            display: flex;
            gap: 10px;
            margin-bottom: var(--element-spacing);
        }

        .library-tab-btn {
            background: var(--card-background);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            padding: 12px 16px;
            border-radius: var(--corner-radius);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .library-tab-btn.active {
            background: var(--sidebar-active);
            color: var(--text-primary);
            border-color: var(--sidebar-active);
        }

        .library-tab-btn:hover {
            background: var(--card-border);
            color: var(--text-primary);
        }

        .count {
            background: var(--card-border);
            color: var(--text-secondary);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
        }

        .library-tab-btn.active .count {
            background: rgba(255,255,255,0.2);
            color: var(--text-primary);
        }

        /* Items List */
        .items-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .item-card {
            background: var(--input-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-info h4 {
            margin: 0 0 5px 0;
            color: var(--text-primary);
            font-size: 14px;
        }

        .item-meta {
            font-size: 11px;
            color: var(--text-muted);
        }

        .item-actions {
            display: flex;
            gap: 5px;
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--element-spacing);
            margin-bottom: var(--element-spacing);
        }

        .stat-card {
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--sidebar-active);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Goal Display */
        .goal-display {
            max-width: 300px;
            margin: 0 auto;
        }

        .goal-current {
            font-size: 36px;
            font-weight: bold;
            color: var(--sidebar-active);
            margin-bottom: 5px;
        }

        .goal-target {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .goal-bar {
            height: 12px;
            background: var(--card-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .goal-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--button-success), var(--sidebar-active));
            transition: width 0.3s ease;
        }

        /* Routines Grid */
        .routines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--element-spacing);
        }

        .routine-card {
            background: var(--input-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .routine-card:hover {
            border-color: var(--sidebar-active);
            transform: translateY(-2px);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .btn-close:hover {
            background: var(--card-border);
        }

        .modal-body {
            padding: 20px;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-background);
            border: 1px solid var(--card-border);
            border-radius: var(--corner-radius);
            padding: 15px 20px;
            color: var(--text-primary);
            z-index: 10001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--button-success);
        }

        .toast-error {
            border-left: 4px solid var(--button-danger);
        }

        .toast-warning {
            border-left: 4px solid #FFC107;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .main-content {
                padding: 10px;
            }
            
            .timer-layout,
            .library-layout {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .routines-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-navigation {
                overflow-x: auto;
                justify-content: flex-start;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .tab-navigation::-webkit-scrollbar {
                display: none;
            }
            
            .tab-button {
                min-width: 90px;
                flex-shrink: 0;
                padding: 10px 12px;
                font-size: 11px;
            }
            
            .timer-display {
                font-size: 36px;
            }
            
            .timer-display-container {
                padding: 20px 10px;
            }
            
            .timer-controls {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .timer-controls .btn {
                height: 50px;
                font-size: 16px;
            }
            
            .btn {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            .form-input,
            .form-select,
            .form-textarea {
                min-height: 44px;
                font-size: 16px;
            }
            
            .toast {
                top: 10px;
                right: 10px;
                left: 10px;
                min-width: auto;
            }
            
            .library-nav {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .library-tab-btn {
                flex: 1;
                min-width: 80px;
                padding: 10px 8px;
                font-size: 11px;
            }
            
            .item-card {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .item-actions {
                justify-content: center;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title">
                    <span class="app-icon">üé∏</span>
                    <div class="title-text">
                        <h1>Practice Manager</h1>
                        <p class="subtitle">Track your practice sessions</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" id="settingsBtn">
                        <span>‚öôÔ∏è</span>
                        <span>Settings</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="tab-navigation">
            <button class="tab-button active" data-tab="practice">
                <span>‚è±Ô∏è</span>
                <span>Practice</span>
            </button>
            <button class="tab-button" data-tab="library">
                <span>üìö</span>
                <span>Library</span>
            </button>
            <button class="tab-button" data-tab="routines">
                <span>üìã</span>
                <span>Routines</span>
            </button>
            <button class="tab-button" data-tab="statistics">
                <span>üìä</span>
                <span>Statistics</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Practice Tab -->
            <section id="practice-tab" class="tab-content active">
                <div class="timer-layout">
                    <!-- Timer Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>‚è±Ô∏è Practice Timer</h3>
                            <span id="timerStatus">Ready</span>
                        </div>
                        
                        <div class="timer-display-container">
                            <div class="timer-display" id="timerDisplay">00:00:00</div>
                        </div>

                        <div class="input-group">
                            <label for="practiceItem">What are you practicing?</label>
                            <select id="practiceItem" class="form-select">
                                <option value="">Select an item...</option>
                            </select>
                        </div>

                        <div class="timer-controls">
                            <button class="btn btn-success" id="startBtn">
                                <span>‚ñ∂Ô∏è</span>
                                <span>Start</span>
                            </button>
                            <button class="btn btn-warning" id="pauseBtn" disabled>
                                <span>‚è∏Ô∏è</span>
                                <span>Pause</span>
                            </button>
                            <button class="btn btn-danger" id="stopBtn" disabled>
                                <span>‚èπÔ∏è</span>
                                <span>Stop</span>
                            </button>
                        </div>
                    </div>

                    <!-- Session Notes -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìù Session Notes</h3>
                            <span id="notesStatus"></span>
                        </div>
                        <div class="input-group">
                            <textarea id="sessionNotes" class="form-textarea" rows="6" 
                                placeholder="What did you work on? Any breakthroughs or challenges?"></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Library Tab -->
            <section id="library-tab" class="tab-content">
                <div class="library-nav">
                    <button class="library-tab-btn active" data-type="songs">
                        <span>üéµ</span>
                        <span>Songs</span>
                        <span class="count" id="songsCount">0</span>
                    </button>
                    <button class="library-tab-btn" data-type="exercises">
                        <span>üí™</span>
                        <span>Exercises</span>
                        <span class="count" id="exercisesCount">0</span>
                    </button>
                    <button class="library-tab-btn" data-type="repertoire">
                        <span>‚≠ê</span>
                        <span>Repertoire</span>
                        <span class="count" id="repertoireCount">0</span>
                    </button>
                </div>

                <div class="library-layout">
                    <!-- Add Item Form -->
                    <div class="card">
                        <div class="card-header">
                            <h3 id="addItemTitle">‚ûï Add New Song</h3>
                        </div>
                        <form id="addItemForm">
                            <div class="input-group">
                                <label for="itemName">Name *</label>
                                <input type="text" id="itemName" class="form-input" required>
                            </div>
                            <div class="input-group" id="artistGroup">
                                <label for="itemArtist">Artist</label>
                                <input type="text" id="itemArtist" class="form-input">
                            </div>
                            <div class="input-group">
                                <label for="itemTags">Tags</label>
                                <input type="text" id="itemTags" class="form-input" 
                                    placeholder="e.g., blues, fingerpicking, beginner">
                            </div>
                            <div class="input-group">
                                <label for="itemNotes">Notes</label>
                                <textarea id="itemNotes" class="form-textarea" rows="3"></textarea>
                            </div>
                            <div class="input-group">
                                <button type="submit" class="btn btn-success">
                                    <span>‚ûï</span>
                                    <span id="addBtnText">Add Song</span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Items List -->
                    <div class="card">
                        <div class="card-header">
                            <h3 id="itemsListTitle">üéµ Your Songs</h3>
                        </div>
                        <div class="items-list" id="itemsList">
                            <div class="empty-state">
                                <span class="empty-icon">üéµ</span>
                                <p>No songs yet. Add your first song!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Routines Tab -->
            <section id="routines-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3>üìã Practice Routines</h3>
                        <button class="btn btn-primary" id="createRoutineBtn">
                            <span>‚ûï</span>
                            <span>Create Routine</span>
                        </button>
                    </div>
                    
                    <div class="routines-grid" id="routinesGrid">
                        <div class="empty-state">
                            <span class="empty-icon">üìã</span>
                            <p>Routines feature coming soon!</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Statistics Tab -->
            <section id="statistics-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTime">0h 0m</div>
                        <div class="stat-label">Total Practice Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalSessions">0</div>
                        <div class="stat-label">Practice Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="averageSession">0m</div>
                        <div class="stat-label">Average Session</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dailyGoalProgress">0%</div>
                        <div class="stat-label">Daily Goal Progress</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>üéØ Daily Goal</h3>
                        <button class="btn btn-primary btn-small" id="editDailyGoal">Edit Goal</button>
                    </div>
                    <div style="padding: 20px; text-align: center;">
                        <div class="goal-display">
                            <div class="goal-current" id="goalCurrent">0 min</div>
                            <div class="goal-target">of <span id="goalTarget">60</span> min goal</div>
                            <div class="goal-bar">
                                <div class="goal-progress" id="goalProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Settings</h3>
                <button class="btn-close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="dailyGoalInput">Daily Practice Goal (minutes)</label>
                    <input type="number" id="dailyGoalInput" class="form-input" min="5" max="480" value="60">
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-danger" id="cancelSettings">Cancel</button>
                    <button class="btn btn-success" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Goal Edit Modal -->
    <div id="dailyGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üéØ Edit Daily Goal</h3>
                <button class="btn-close" id="closeDailyGoal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="newDailyGoal">Daily Practice Goal (minutes)</label>
                    <input type="number" id="newDailyGoal" class="form-input" min="5" max="480" value="60">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-danger" id="cancelDailyGoal">Cancel</button>
                    <button class="btn btn-success" id="saveDailyGoal">Save Goal</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Starting Practice Manager...');

        // Application State
        const appState = {
            activeTab: 'practice',
            currentLibraryType: 'songs',
            timer: {
                isRunning: false,
                isPaused: false,
                startTime: null,
                elapsed: 0,
                currentItem: null
            },
            settings: {
                dailyGoal: 60
            },
            data: {
                songs: [],
                exercises: [],
                repertoire: [],
                routines: [],
                sessions: [],
                notes: {}
            }
        };

        let timerInterval = null;

        // Initialize App
        function initApp() {
            console.log('üì± Initializing app...');
            try {
                loadData();
                setupEventListeners();
                updateUI();
                console.log('‚úÖ App initialized successfully');
            } catch (error) {
                console.error('‚ùå Error initializing app:', error);
            }
        }

        // Event Listeners
        function setupEventListeners() {
            console.log('üîß Setting up event listeners...');

            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tabId = e.currentTarget.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Library navigation
            document.querySelectorAll('.library-tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const type = e.currentTarget.getAttribute('data-type');
                    switchLibraryType(type);
                });
            });

            // Timer controls
            document.getElementById('startBtn').addEventListener('click', startTimer);
            document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
            document.getElementById('stopBtn').addEventListener('click', stopTimer);

            // Session notes
            document.getElementById('sessionNotes').addEventListener('input', saveSessionNotes);
            document.getElementById('practiceItem').addEventListener('change', loadSessionNotes);

            // Library form
            document.getElementById('addItemForm').addEventListener('submit', handleAddItem);

            // Create routine
            document.getElementById('createRoutineBtn').addEventListener('click', showCreateRoutineModal);

            // Settings
            document.getElementById('settingsBtn').addEventListener('click', showSettingsModal);
            document.getElementById('closeSettings').addEventListener('click', hideSettingsModal);
            document.getElementById('cancelSettings').addEventListener('click', hideSettingsModal);
            document.getElementById('saveSettings').addEventListener('click', saveSettings);

            // Daily goal
            document.getElementById('editDailyGoal').addEventListener('click', showDailyGoalModal);
            document.getElementById('closeDailyGoal').addEventListener('click', hideDailyGoalModal);
            document.getElementById('cancelDailyGoal').addEventListener('click', hideDailyGoalModal);
            document.getElementById('saveDailyGoal').addEventListener('click', saveDailyGoal);

            // Modal close on outside click
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    hideSettingsModal();
                    hideDailyGoalModal();
                }
            });

            console.log('‚úÖ Event listeners setup complete');
        }

        // Tab Management
        function switchTab(tabId) {
            console.log('üîÑ Switching to tab:', tabId);
            
            // Update navigation
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');

            appState.activeTab = tabId;

            // Load tab-specific data
            if (tabId === 'statistics') {
                updateStatistics();
            } else if (tabId === 'library') {
                updateLibraryDisplay();
            }
        }

        function switchLibraryType(type) {
            console.log('üìö Switching library type to:', type);
            
            document.querySelectorAll('.library-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');

            appState.currentLibraryType = type;
            updateLibraryDisplay();
        }

        // Timer Functions
        function startTimer() {
            const selectedItem = document.getElementById('practiceItem').value;
            if (!selectedItem) {
                showToast('Please select what you are practicing!', 'warning');
                return;
            }

            console.log('‚ñ∂Ô∏è Starting timer for:', selectedItem);

            if (appState.timer.isPaused) {
                // Resume
                appState.timer.startTime = Date.now() - appState.timer.elapsed;
                appState.timer.isPaused = false;
            } else {
                // Fresh start
                appState.timer.startTime = Date.now();
                appState.timer.elapsed = 0;
                appState.timer.currentItem = selectedItem;
                loadSessionNotes();
            }

            appState.timer.isRunning = true;
            updateTimerButtons();
            
            timerInterval = setInterval(updateTimer, 1000);
            showToast('Timer started!', 'success');
        }

        function pauseTimer() {
            console.log('‚è∏Ô∏è Pausing timer');
            appState.timer.isRunning = false;
            appState.timer.isPaused = true;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            updateTimerButtons();
            showToast('Timer paused', 'warning');
        }

        function stopTimer() {
            const sessionDuration = Math.floor(appState.timer.elapsed / 1000);
            console.log('‚èπÔ∏è Stopping timer. Duration:', sessionDuration, 'seconds');
            
            appState.timer.isRunning = false;
            appState.timer.isPaused = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Save session if longer than 1 minute
            if (sessionDuration >= 60) {
                saveSession(appState.timer.currentItem, sessionDuration);
                showToast('Session saved!', 'success');
            }
            
            // Reset timer
            appState.timer.elapsed = 0;
            appState.timer.startTime = null;
            appState.timer.currentItem = null;
            
            updateTimerDisplay();
            updateTimerButtons();
            updateStatistics();
        }

        function updateTimer() {
            if (appState.timer.isRunning && appState.timer.startTime) {
                appState.timer.elapsed = Date.now() - appState.timer.startTime;
                updateTimerDisplay();
            }
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timerDisplay');
            const seconds = Math.floor(appState.timer.elapsed / 1000);
            display.textContent = formatTime(seconds);
            
            if (appState.timer.isRunning) {
                display.classList.add('running');
                display.classList.remove('paused');
                document.title = `${formatTime(seconds)} - Practice Manager`;
            } else if (appState.timer.isPaused) {
                display.classList.add('paused');
                display.classList.remove('running');
            } else {
                display.classList.remove('running', 'paused');
                document.title = 'Practice Manager';
            }
        }

        function updateTimerButtons() {
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (appState.timer.isRunning) {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                startBtn.innerHTML = '<span>‚ñ∂Ô∏è</span><span>Running...</span>';
            } else if (appState.timer.isPaused) {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = false;
                startBtn.innerHTML = '<span>‚ñ∂Ô∏è</span><span>Resume</span>';
            } else {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                startBtn.innerHTML = '<span>‚ñ∂Ô∏è</span><span>Start</span>';
            }
        }

        // Session Notes Functions
        function saveSessionNotes() {
            const notes = document.getElementById('sessionNotes').value;
            const currentItem = appState.timer.currentItem || document.getElementById('practiceItem').value || 'general';
            
            appState.data.notes[currentItem] = notes;
            saveData();
            
            // Visual feedback
            const status = document.getElementById('notesStatus');
            status.textContent = '‚úì Saved';
            status.style.color = 'var(--button-success)';
            setTimeout(() => {
                status.textContent = '';
            }, 2000);
            
            console.log('üìù Session notes saved for:', currentItem);
        }

        function loadSessionNotes() {
            const currentItem = appState.timer.currentItem || document.getElementById('practiceItem').value || 'general';
            const notes = appState.data.notes[currentItem] || '';
            document.getElementById('sessionNotes').value = notes;
            console.log('üìñ Session notes loaded for:', currentItem);
        }

        // Library Functions
        function handleAddItem(e) {
            e.preventDefault();
            console.log('‚ûï Adding new item to library...');
            
            const name = document.getElementById('itemName').value.trim();
            const artist = document.getElementById('itemArtist').value.trim();
            const tags = document.getElementById('itemTags').value.split(',').map(t => t.trim()).filter(t => t);
            const notes = document.getElementById('itemNotes').value.trim();
            
            if (!name) {
                showToast('Name is required!', 'error');
                return;
            }
            
            const item = {
                id: Date.now(),
                name,
                artist,
                tags,
                notes,
                practiceCount: 0,
                addedDate: new Date().toISOString()
            };
            
            appState.data[appState.currentLibraryType].push(item);
            saveData();
            updateLibraryDisplay();
            updatePracticeItemsSelect();
            
            // Clear form
            document.getElementById('addItemForm').reset();
            
            showToast(`${item.name} added successfully!`, 'success');
            console.log('‚úÖ Item added:', item);
        }

        function updateLibraryDisplay() {
            const type = appState.currentLibraryType;
            const items = appState.data[type];
            
            console.log('üìö Updating library display for:', type, '- Items:', items.length);
            
            // Update title and button text
            const titles = {
                songs: { title: 'üéµ Your Songs', add: 'Add Song', form: '‚ûï Add New Song' },
                exercises: { title: 'üí™ Your Exercises', add: 'Add Exercise', form: '‚ûï Add New Exercise' },
                repertoire: { title: '‚≠ê Your Repertoire', add: 'Add Repertoire', form: '‚ûï Add New Repertoire' }
            };
            
            const titleInfo = titles[type];
            document.getElementById('itemsListTitle').textContent = titleInfo.title;
            document.getElementById('addBtnText').textContent = titleInfo.add;
            document.getElementById('addItemTitle').textContent = titleInfo.form;
            
            // Show/hide artist field for songs and repertoire
            const artistGroup = document.getElementById('artistGroup');
            artistGroup.style.display = (type === 'songs' || type === 'repertoire') ? 'block' : 'none';
            
            // Update counts
            document.getElementById(type + 'Count').textContent = items.length;
            
            // Update items list
            const itemsList = document.getElementById('itemsList');
            
            if (items.length === 0) {
                itemsList.innerHTML = `
                    <div class="empty-state">
                        <span class="empty-icon">${type === 'songs' ? 'üéµ' : type === 'exercises' ? 'üí™' : '‚≠ê'}</span>
                        <p>No ${type} yet. Add your first ${type.slice(0, -1)}!</p>
                    </div>
                `;
                return;
            }
            
            itemsList.innerHTML = items.map(item => `
                <div class="item-card">
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <div class="item-meta">
                            ${item.artist ? `${item.artist} ‚Ä¢ ` : ''}
                            ${item.practiceCount || 0} sessions
                            ${item.tags && item.tags.length ? ` ‚Ä¢ ${item.tags.join(', ')}` : ''}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-small" onclick="quickPractice('${item.name.replace(/'/g, "\\'")}', '${type}')">
                            üéØ Practice
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteItem(${item.id}, '${type}')">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteItem(id, type) {
            if (confirm('Are you sure you want to delete this item?')) {
                console.log('üóëÔ∏è Deleting item:', id, 'from', type);
                appState.data[type] = appState.data[type].filter(item => item.id !== id);
                saveData();
                updateLibraryDisplay();
                updatePracticeItemsSelect();
                showToast('Item deleted', 'success');
            }
        }

        function quickPractice(itemName, type) {
            const typeLabels = {
                songs: 'Song',
                exercises: 'Exercise', 
                repertoire: 'Repertoire'
            };
            
            const displayName = `${typeLabels[type]}: ${itemName}`;
            document.getElementById('practiceItem').value = displayName;
            switchTab('practice');
            showToast(`Ready to practice ${itemName}!`, 'success');
            console.log('üéØ Quick practice selected:', displayName);
        }

        function updatePracticeItemsSelect() {
            const select = document.getElementById('practiceItem');
            const allItems = [
                ...appState.data.songs.map(s => `Song: ${s.name}`),
                ...appState.data.exercises.map(e => `Exercise: ${e.name}`),
                ...appState.data.repertoire.map(r => `Repertoire: ${r.name}`)
            ];
            
            const currentValue = select.value;
            
            if (allItems.length === 0) {
                select.innerHTML = '<option value="">Add items to your library first...</option>';
            } else {
                select.innerHTML = '<option value="">Select an item...</option>' + 
                    allItems.map(item => `<option value="${item}">${item}</option>`).join('');
                
                if (allItems.includes(currentValue)) {
                    select.value = currentValue;
                }
            }
            
            console.log('üìã Practice items updated. Total items:', allItems.length);
        }

        // Statistics Functions
        function updateStatistics() {
            const sessions = appState.data.sessions;
            
            if (sessions.length === 0) {
                document.getElementById('totalTime').textContent = '0h 0m';
                document.getElementById('totalSessions').textContent = '0';
                document.getElementById('averageSession').textContent = '0m';
                document.getElementById('dailyGoalProgress').textContent = '0%';
                updateDailyGoalDisplay(0);
                return;
            }
            
            const totalTime = sessions.reduce((sum, session) => sum + session.duration, 0);
            const totalSessions = sessions.length;
            const averageSession = Math.floor(totalTime / totalSessions);
            
            // Calculate today's progress
            const today = new Date().toDateString();
            const todaySessions = sessions.filter(session => 
                new Date(session.date).toDateString() === today
            );
            const todayTime = todaySessions.reduce((sum, session) => sum + session.duration, 0);
            const todayMinutes = Math.floor(todayTime / 60);
            const goalProgress = Math.min((todayMinutes / appState.settings.dailyGoal) * 100, 100);
            
            document.getElementById('totalTime').textContent = formatTimeStats(totalTime);
            document.getElementById('totalSessions').textContent = totalSessions;
            document.getElementById('averageSession').textContent = formatTimeStats(averageSession);
            document.getElementById('dailyGoalProgress').textContent = Math.round(goalProgress) + '%';
            
            updateDailyGoalDisplay(todayMinutes);
            
            console.log('üìä Statistics updated. Total sessions:', totalSessions);
        }

        function updateDailyGoalDisplay(currentMinutes) {
            document.getElementById('goalCurrent').textContent = `${currentMinutes} min`;
            document.getElementById('goalTarget').textContent = appState.settings.dailyGoal;
            
            const progress = Math.min((currentMinutes / appState.settings.dailyGoal) * 100, 100);
            document.getElementById('goalProgressBar').style.width = progress + '%';
        }

        // Settings Functions
        function showSettingsModal() {
            document.getElementById('settingsModal').style.display = 'block';
            document.getElementById('dailyGoalInput').value = appState.settings.dailyGoal;
        }

        function hideSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function saveSettings() {
            appState.settings.dailyGoal = parseInt(document.getElementById('dailyGoalInput').value);
            saveData();
            updateStatistics();
            hideSettingsModal();
            showToast('Settings saved!', 'success');
        }

        // Daily Goal Functions
        function showDailyGoalModal() {
            document.getElementById('dailyGoalModal').style.display = 'block';
            document.getElementById('newDailyGoal').value = appState.settings.dailyGoal;
        }

        function hideDailyGoalModal() {
            document.getElementById('dailyGoalModal').style.display = 'none';
        }

        function saveDailyGoal() {
            const newGoal = parseInt(document.getElementById('newDailyGoal').value);
            if (newGoal >= 5 && newGoal <= 480) {
                appState.settings.dailyGoal = newGoal;
                saveData();
                updateStatistics();
                hideDailyGoalModal();
                showToast('Daily goal updated!', 'success');
            } else {
                showToast('Goal must be between 5 and 480 minutes', 'error');
            }
        }

        // Routine Functions (placeholder)
        function showCreateRoutineModal() {
            showToast('Routines feature coming soon!', 'info');
        }

        // Data Management
        function saveSession(item, duration) {
            const session = {
                id: Date.now(),
                item,
                duration,
                date: new Date().toISOString(),
                notes: appState.data.notes[item] || ''
            };
            
            appState.data.sessions.push(session);
            saveData();
            console.log('üíæ Session saved:', session);
        }

        function saveData() {
            const dataToSave = {
                songs: appState.data.songs,
                exercises: appState.data.exercises,
                repertoire: appState.data.repertoire,
                routines: appState.data.routines,
                sessions: appState.data.sessions,
                notes: appState.data.notes,
                settings: appState.settings
            };
            localStorage.setItem('practiceManagerData', JSON.stringify(dataToSave));
            console.log('üíæ Data saved to localStorage');
        }

        function loadData() {
            const saved = localStorage.getItem('practiceManagerData');
            if (saved) {
                try {
                    const loadedData = JSON.parse(saved);
                    appState.data.songs = loadedData.songs || [];
                    appState.data.exercises = loadedData.exercises || [];
                    appState.data.repertoire = loadedData.repertoire || [];
                    appState.data.routines = loadedData.routines || [];
                    appState.data.sessions = loadedData.sessions || [];
                    appState.data.notes = loadedData.notes || {};
                    appState.settings.dailyGoal = loadedData.settings?.dailyGoal || 60;
                    console.log('üìÇ Data loaded from localStorage');
                } catch (e) {
                    console.error('‚ùå Error loading data:', e);
                }
            } else {
                console.log('üìÇ No saved data found, starting fresh');
            }
        }

        function updateUI() {
            updateStatistics();
            updateTimerDisplay();
            updateTimerButtons();
            updatePracticeItemsSelect();
            updateLibraryDisplay();
            loadSessionNotes();
        }

        // Utility Functions
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }

        function formatTimeStats(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m`;
            } else {
                return `${seconds}s`;
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Debug function
        function debugShowData() {
            console.log('üîç Current app state:', appState);
            console.log('üîç localStorage data:', localStorage.getItem('practiceManagerData'));
            console.log('üîç Session notes:', appState.data.notes);
        }

        // Make functions globally available
        window.quickPractice = quickPractice;
        window.deleteItem = deleteItem;
        window.debugShowData = debugShowData;

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM loaded, initializing app...');
            initApp();
        });

        // Mobile optimizations
        function setupMobileOptimizations() {
            // Prevent zoom on double tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Handle orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    updateUI();
                }, 500);
            });
        }

        // Setup mobile optimizations
        if (window.innerWidth <= 768) {
            setupMobileOptimizations();
        }
    </script>
</body>
</html>
